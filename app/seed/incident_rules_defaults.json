[
  {
    "code": "INC-ACC-01",
    "name": "Account Compromise",
    "enabled": true,
    "scope": "global",
    "severity_base": 85,
    "score_bonus": 20,
    "window_seconds": 3600,
    "cooldown_seconds": 21600,
    "primary_entity_type": "user",
    "primary_entity_field": "username",
    "group_by": ["server", "username"],
    "match": { "alert_codes_any": ["AUTH-003", "AUTH-005", "MAIL-002", "MULTI-002"] },
    "condition": "count >= 1",
    "description": "≥1 éxito anómalo (post-fail o geo) en auth/mail o reuso de credenciales cross-server.",
    "tags": ["account", "takeover"]
  },
  {
    "code": "INC-ACC-02",
    "name": "Privileged Account Compromise",
    "enabled": true,
    "scope": "global",
    "severity_base": 95,
    "score_bonus": 35,
    "window_seconds": 21600,
    "cooldown_seconds": 86400,
    "primary_entity_type": "user",
    "primary_entity_field": "username",
    "group_by": ["server", "username"],
    "match": { "alert_codes_any": ["AUTH-006", "SYS-001"] },
    "condition": "count >= 1",
    "description": "Acceso privilegiado desde IP nueva y/o país anómalo.",
    "tags": ["privileged", "account", "critical"]
  },
  {
    "code": "INC-WEB-01",
    "name": "Web Attack",
    "enabled": true,
    "scope": "local",
    "severity_base": 60,
    "score_bonus": 10,
    "window_seconds": 900,
    "cooldown_seconds": 1800,
    "primary_entity_type": "ip",
    "primary_entity_field": "ip_client",
    "group_by": ["server", "ip_client"],
    "match": { "alert_codes_any": ["WEB-001", "WEB-002", "WEB-003", "WEB-004", "WEB-006"] },
    "condition": "count >= 2 or max_severity >= 15",
    "description": "≥2 alertas web o 1 exploit fuerte.",
    "tags": ["web", "attack"]
  },
  {
    "code": "INC-WEB-02",
    "name": "Webshell / Malware Upload",
    "enabled": true,
    "scope": "local",
    "severity_base": 95,
    "score_bonus": 35,
    "window_seconds": 21600,
    "cooldown_seconds": 21600,
    "primary_entity_type": "host",
    "primary_entity_field": "server",
    "group_by": ["server"],
    "match": { "alert_codes_any": ["FILE-001", "FILE-003", "FILE-004"] },
    "condition": "count >= 1",
    "description": "Señal crítica: subida sospechosa, ofuscación o ejecución en /tmp.",
    "tags": ["malware", "webshell", "critical"]
  },
  {
    "code": "INC-WP-01",
    "name": "WordPress Compromise",
    "enabled": true,
    "scope": "local",
    "severity_base": 85,
    "score_bonus": 15,
    "window_seconds": 21600,
    "cooldown_seconds": 21600,
    "primary_entity_type": "host",
    "primary_entity_field": "extra.vhost",
    "group_by": ["server", "extra.vhost"],
    "match": { "alert_codes_any": ["FILE-002", "WEB-002", "WEB-005", "FILE-001"] },
    "condition": "count >= 1 and (unique_alerts >= 2 or max_severity >= 20)",
    "description": "Integridad WP rota + señal de abuso (xmlrpc/wp-login/upload).",
    "tags": ["wordpress", "compromise"]
  },
  {
    "code": "INC-MAIL-01",
    "name": "Mail Abuse / Spam",
    "enabled": true,
    "scope": "global",
    "severity_base": 95,
    "score_bonus": 25,
    "window_seconds": 7200,
    "cooldown_seconds": 21600,
    "primary_entity_type": "host",
    "primary_entity_field": "server",
    "group_by": ["server"],
    "match": { "alert_codes_any": ["MAIL-002", "MAIL-003", "MAIL-004"] },
    "condition": "count >= 1",
    "description": "Abuso confirmado: takeover mail, volumen saliente alto y/o geo riesgoso.",
    "tags": ["mail", "spam", "abuse"]
  },
  {
    "code": "INC-SYS-01",
    "name": "SSH Compromise",
    "enabled": true,
    "scope": "local",
    "severity_base": 95,
    "score_bonus": 30,
    "window_seconds": 3600,
    "cooldown_seconds": 21600,
    "primary_entity_type": "host",
    "primary_entity_field": "server",
    "group_by": ["server"],
    "match": { "alert_codes_any": ["SYS-001", "SYS-002"] },
    "condition": "count >= 1 and unique_alerts >= 2",
    "description": "Acceso (país/IP anómalo) + elevación de privilegios (sudo/su/pkexec/polkit).",
    "tags": ["ssh", "privilege", "critical"]
  },
  {
    "code": "INC-SYS-02",
    "name": "System Persistence Detected",
    "enabled": true,
    "scope": "local",
    "severity_base": 95,
    "score_bonus": 30,
    "window_seconds": 28800,
    "cooldown_seconds": 28800,
    "primary_entity_type": "host",
    "primary_entity_field": "server",
    "group_by": ["server"],
    "match": { "alert_codes_any": ["SYS-003", "FILE-003"] },
    "condition": "count >= 1",
    "description": "Persistencia detectada: cron/systemd timer sospechoso y/o ofuscación.",
    "tags": ["persistence", "cron", "critical"]
  },
  {
    "code": "INC-GLOB-01",
    "name": "Distributed Attack",
    "enabled": true,
    "scope": "global",
    "severity_base": 95,
    "score_bonus": 25,
    "window_seconds": 1800,
    "cooldown_seconds": 1800,
    "primary_entity_type": "ip",
    "primary_entity_field": "ip_client",
    "group_by": ["ip_client"],
    "match": { "alert_codes_any": ["MULTI-001", "WEB-008"] },
    "condition": "count >= 1",
    "description": "Coordinación multi-host (misma IP atacando múltiples servers) y/o flood por subnet /24.",
    "tags": ["distributed", "global", "attack"]
  },
  {
    "code": "INC-GLOB-02",
    "name": "Credential Stuffing Campaign",
    "enabled": true,
    "scope": "global",
    "severity_base": 85,
    "score_bonus": 20,
    "window_seconds": 3600,
    "cooldown_seconds": 3600,
    "primary_entity_type": "user",
    "primary_entity_field": "username",
    "group_by": ["username"],
    "match": { "alert_codes_any": ["AUTH-002", "MULTI-002"] },
    "condition": "count >= 1",
    "description": "Stuffing + reuso de credenciales cross-server (fallos en un host y éxito en otro).",
    "tags": ["credential", "stuffing", "global"]
  },
  {
    "code": "INC-GLOB-03",
    "name": "DDoS Campaign",
    "enabled": true,
    "scope": "global",
    "severity_base": 95,
    "score_bonus": 20,
    "window_seconds": 900,
    "cooldown_seconds": 1800,
    "primary_entity_type": "asn",
    "primary_entity_field": "extra.asn.number",
    "group_by": ["extra.asn.number"],
    "match": { "alert_codes_any": ["WEB-006", "WEB-008", "WEB-009", "WEB-012", "MULTI-003"] },
    "condition": "count >= 1 and (unique_servers >= 2 or max_severity >= 15)",
    "description": "Flood distribuido (IP/Subnet/Country/ASN) y/o ASN flood multi-host.",
    "tags": ["ddos", "asn", "global"]
  },
  {
    "code": "INC-GLOB-04",
    "name": "Suspected DDoS Impact",
    "enabled": true,
    "scope": "global",
    "severity_base": 85,
    "score_bonus": 15,
    "window_seconds": 1800,
    "cooldown_seconds": 3600,
    "primary_entity_type": "host",
    "primary_entity_field": "server",
    "group_by": ["server"],
    "match": { "alert_codes_any": ["RES-001", "RES-002", "DB-002", "WEB-006", "WEB-008", "WEB-009", "WEB-012", "MULTI-003"] },
    "condition": "count >= 2",
    "description": "Impacto (recursos/degradación) + señal de flood: CPU/PHP/DB altos junto a flood web o campaña multi-host.",
    "tags": ["ddos", "impact", "resources"]
  },
  
  {
    "code": "INC-LFD-01",
    "name": "LFD Attack + Resource Impact",
    "enabled": true,
    "scope": "local",
    "severity_base": 80,
    "score_bonus": 15,
    "window_seconds": 900,
    "cooldown_seconds": 3600,
    "primary_entity_type": "host",
    "primary_entity_field": "server",
    "group_by": ["server"],
    "match": {
      "alert_codes_any": [
        "LFD-001",
        "LFD-002",
        "LFD-003",
        "LFD-004",
        "LFD-007",
        "LFD-008",
        "RES-001",
        "RES-002"
      ]
    },
    "condition": "count >= 2 and unique_alerts >= 2",
    "description": "Correlación local: ≥1 alerta LFD (bloqueos/campaña) + ≥1 alerta de carga/recursos (RES) dentro de la ventana.",
    "tags": ["lfd", "attack", "impact", "resources", "ddos_suspected"]
  },

  {
    "code": "INC-LFD-02",
    "name": "Distributed LFD Campaign + Multi-Host Impact",
    "enabled": true,
    "scope": "global",
    "severity_base": 90,
    "score_bonus": 20,
    "window_seconds": 1800,
    "cooldown_seconds": 7200,
    "primary_entity_type": "asn",
    "primary_entity_field": "extra.asn.number",
    "group_by": ["extra.asn.number"],
    "match": {
      "alert_codes_any": [
        "LFD-003",
        "LFD-005",
        "LFD-006",
        "RES-001",
        "RES-002"
      ]
    },
    "condition": "count >= 2 and unique_servers >= 2 and unique_alerts >= 2",
    "description": "Correlación global: campaña LFD por ASN/país + impacto de recursos (RES) en ≥2 servidores dentro de la ventana.",
    "tags": ["lfd", "campaign", "global", "asn", "impact", "resources"]
  }
]

